<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
        <meta charset="utf-8">
        <title>Iridis Trader</title>
        <meta name="description" content="Iridis trading Web app">
        <style>
            #nojs{
                position: absolute;
                top: 0px;
                left: 0px;
                width: 100%;
                background: yellow;
                color: red;
            }
            #log{
                width: 100%;
                background: yellow;
                color: black;
            }
        </style>
        <script src="http://code.jquery.com/jquery-latest.min.js"></script>
        <script type="text/javascript">

function log(msg){
    console.log(msg);
    if('string' === typeof msg) $('#log').prepend($('<div>').text(msg));
};

function RPC(server, methodname, params, callback){
    var url = 'http://127.0.0.1:'
    var servers = {
        color: '6711',
        message: '6712',
        bitcoin: '6714'
    };
    if('undefined' === typeof(servers[server])) return callback('unknown server ' + server);
    else url += servers[server];
    $.ajax({
        url: url,
        type: 'POST',
        contenType: 'application/json',
        dataType: 'json',
        data: JSON.stringify({
            'jsonrpc': '2.0',
            'method': methodname,
            'params': params,
            'id': 1
        }),
        success: function(response) { callback(response.result); },
        error: log
    });
}

$(function(){
    log('js detected');
    $('#nojs').remove();

    RPC('testing', 'testing', [{}, {}], function(error){
        log(error);
    });

    RPC('bitcoin', 'decoderawtransaction', ['01000000019a6343df138c66e34f532083ede5c06c718a68722c20bcd5fb173d2cb6a572c3010000008b483045022100b8b8fd541cbf83b606b870a56aa69e6c183ca42cc68d044e8070a2ebcbc728c2022022df5ce95655f5f0ea227f956143b6ebf54ab64b952fae765d43cce96281d6b20141047a58aec854d5ab569f31efe4512fad0e4f65f53bed2b61945c4a65aa7c0e6c51ba37ea742053abe69018157d80df0328a70f952b4c409cf93372a84e665d3073ffffffff02e8030000000000001976a91477d01d5e300233dd7a825333c01e9c5fd4edb41388ac38e99203000000001976a91474f5bef575a8563a1683096e90e45904056cce8988ac00000000'], function(info){
        log(info.txid);
    });
    RPC('color', 'colorvalue', [{}, {}], function(value){
        log('' + value);
    });
    //RPC('message', 'send', ['subj2', {'this': 'body3'}], function(messages){
    //    log(messages);
    //});
    RPC('message', 'receive', [], function(messages){
        $.each(messages, function(i, message){
            log(message.subject);
        });
    });
});

        </script>
    </head>
    <body>
        <div id="nojs">Either you have JavaScript disabled, or we have a serious bug.</div>
        <div id="log"></div>
    </body>
</html>
<!--
vim: ft=javascript
-->
